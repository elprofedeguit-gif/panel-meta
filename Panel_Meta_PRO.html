<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Meta PRO</title>
<style>
body{font-family:Segoe UI,Arial;background:#f2f4f8;padding:20px}
.container{max-width:1000px;margin:auto;background:white;padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
input{width:100%;padding:10px;font-size:16px;border-radius:8px;border:2px solid #ddd}
label{font-size:13px;color:#555;font-weight:bold}
.section{background:#fafbff;padding:15px;border-radius:10px}
.green{color:#2e7d32;font-weight:bold}
.yellow{color:#f9a825;font-weight:bold}
.red{color:#c62828;font-weight:bold}
.status{font-size:12px;color:#777;margin-bottom:10px}
button{padding:8px 14px;border:0;border-radius:8px;background:#3f51b5;color:white;font-weight:bold;cursor:pointer;margin-bottom:10px}
</style>
</head>
<body>
<div class="container">
<h2>Panel Meta Ads PRO</h2>

<button onclick="actualizarCotizacion()">Actualizar cotización</button>
<div class="status" id="status">Actualizando cotización…</div>

<div class="grid">
<div class="section">
<label>USD</label>
<input id="usd" oninput="calcFrom('usd')">
<label>ARS</label>
<input id="ars" oninput="calcFrom('ars')">
<label>CLP Total (con IVA)</label>
<input id="clp" oninput="calcFrom('clp')">
<label>Neto Meta CLP (sin IVA)</label>
<input id="neto" oninput="calcFrom('neto')">
<div>IVA 19%: <span id="iva">0</span></div>
</div>

<div class="section">
<h3>Métricas Meta Ads (ingresar CLP neto)</h3>

<p>CPC sin clic: <span id="cpc1"></span></p>
<p>CPC con clic: <span id="cpc2"></span></p>
<label>Tu CPC real (CLP)</label>
<input id="cpcR" oninput="evalMetrics()">
<div id="cpcState"></div>

<hr>

<p>Pago sin iniciar: <span id="pay1"></span></p>
<p>Pago iniciado: <span id="pay2"></span></p>
<label>Tu pago real (CLP)</label>
<input id="payR" oninput="evalMetrics()">
<div id="payState"></div>

<hr>

<p>Compra sin venta: <span id="buy1"></span></p>
<p>Compra con venta: <span id="buy2"></span></p>
<label>Tu CPA real (CLP)</label>
<input id="buyR" oninput="evalMetrics()">
<div id="buyState"></div>

</div>
</div>
</div>

<script>
let TASA_ARS = 1500;
let TASA_CLP = 900;
const IVA = 1.19;

function actualizarCotizacion(){
 document.getElementById("status").innerText="Actualizando cotización…";
 fetch("https://api.frankfurter.app/latest?from=USD&to=ARS,CLP")
 .then(r=>r.json())
 .then(d=>{
   TASA_ARS = d.rates.ARS;
   TASA_CLP = d.rates.CLP;
   document.getElementById("status").innerText =
     "USD→ARS " + TASA_ARS.toFixed(2) +
     " | USD→CLP " + TASA_CLP.toFixed(2);
   updateLimits();
 })
 .catch(()=>{
   document.getElementById("status").innerText =
     "No se pudo actualizar la cotización.";
 });
}

function limpiarTodo(){
 usd.value="";
 ars.value="";
 clp.value="";
 neto.value="";
 iva.innerText="0";
}

function calcFrom(src){
 let input = document.getElementById(src);
 if(input.value===""){ limpiarTodo(); return; }

 let usdVal;
 let v=parseFloat(input.value);
 if(isNaN(v)) return;

 if(src=="usd") usdVal=v;
 if(src=="ars") usdVal=v/TASA_ARS;
 if(src=="clp") usdVal=(v/IVA)/TASA_CLP;
 if(src=="neto") usdVal=(v*IVA)/TASA_CLP;

 let arsVal=usdVal*TASA_ARS;
 let clpVal=usdVal*TASA_CLP;
 let netoVal=clpVal/IVA;

 if(src!=="usd") usd.value=usdVal.toFixed(2);
 if(src!=="ars") ars.value=Math.round(arsVal);
 if(src!=="clp") clp.value=Math.round(clpVal);
 if(src!=="neto") neto.value=Math.round(netoVal);

 iva.innerText=Math.round(clpVal-netoVal);
 updateLimits();
}

function usdToCLPNet(v){
 return Math.round((v*TASA_CLP)/IVA);
}

function updateLimits(){
 cpc1.innerText=usdToCLPNet(0.5);
 cpc2.innerText=usdToCLPNet(0.7);
 pay1.innerText=usdToCLPNet(2.5);
 pay2.innerText=usdToCLPNet(3.5);
 buy1.innerText=usdToCLPNet(9);
 buy2.innerText=usdToCLPNet(13);
 evalMetrics();
}

function stateCLP(val,a,b){
 if(isNaN(val)) return "";
 if(val<=a) return "<span class='green'>OK</span>";
 if(val<=b) return "<span class='yellow'>Aguantar</span>";
 return "<span class='red'>Cortar</span>";
}

function evalMetrics(){
 let cpc=parseFloat(cpcR.value);
 let pay=parseFloat(payR.value);
 let buy=parseFloat(buyR.value);

 let cpcA=usdToCLPNet(0.5);
 let cpcB=usdToCLPNet(0.7);
 let payA=usdToCLPNet(2.5);
 let payB=usdToCLPNet(3.5);
 let buyA=usdToCLPNet(9);
 let buyB=usdToCLPNet(13);

 cpcState.innerHTML=stateCLP(cpc,cpcA,cpcB);
 payState.innerHTML=stateCLP(pay,payA,payB);
 buyState.innerHTML=stateCLP(buy,buyA,buyB);
}

actualizarCotizacion();
setInterval(actualizarCotizacion,900000);
</script>
</body>
</html>
